{% extends 'base.html' %}
{% block content %}
<div class="cart-add-container">
    <div class="product-selection-box">
        <h3><i class="fas fa-shopping-cart" style="color: var(--primary-color); margin-right: 10px;"></i>Confirm Quantity</h3>
        <p style="color: var(--text-light); margin-bottom: 20px;">Choose how many items you'd like to add. <br> <strong>Available: {{ post.quantity }}</strong></p>
        
        <form method="post">
            {% csrf_token %}
            
            <div class="quantity-wrapper">
                <button type="button" id="minusBtn" class="qty-btn" {% if post.quantity <= 0 %}disabled{% endif %}><i class="fas fa-minus"></i></button>
                <input type="number" name="quantity" id="id_quantity" value="{% if post.quantity > 0 %}1{% else %}0{% endif %}" min="1" max="{{ post.quantity }}" readonly>
                <button type="button" id="plusBtn" class="qty-btn" {% if post.quantity <= 1 %}disabled{% endif %}><i class="fas fa-plus"></i></button>
            </div>

            {% if form.quantity.errors %}
                <div style="color: red; margin-top: 10px;">{{ form.quantity.errors }}</div>
            {% endif %}

            <div class="cart-actions">
                <button type="submit" class="btn-confirm" {% if post.quantity <= 0 %}disabled{% endif %}>
                    {% if post.quantity > 0 %}Add to Cart{% else %}Out of Stock{% endif %}
                </button>
                <a href="{% url 'post_detail' pk=post.pk %}" class="btn-cancel">
                    <i class="fas fa-arrow-left"></i> Back to Product
                </a>
            </div>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const minusBtn = document.getElementById('minusBtn');
        const plusBtn = document.getElementById('plusBtn');
        const qtyInput = document.getElementById('id_quantity');
        const maxQty = parseInt("{{ post.quantity }}") || 0;

        function updateButtons() {
            let currentVal = parseInt(qtyInput.value) || 0;
            minusBtn.disabled = currentVal <= 1;
            plusBtn.disabled = currentVal >= maxQty;
        }

        if (plusBtn && minusBtn && qtyInput) {
            plusBtn.onclick = function() {
                let currentVal = parseInt(qtyInput.value) || 1;
                if (currentVal < maxQty) {
                    qtyInput.value = currentVal + 1;
                    updateButtons();
                }
            };

            minusBtn.onclick = function() {
                let currentVal = parseInt(qtyInput.value) || 1;
                if (currentVal > 1) {
                    qtyInput.value = currentVal - 1;
                    updateButtons();
                }
            };
            
            updateButtons();
        }
    });
</script>
{% endblock %}
